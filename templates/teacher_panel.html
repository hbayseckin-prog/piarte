{% extends "base.html" %}
{% block title %}Öğretmen Paneli - Piarte{% endblock %}
{% block content %}
<h2 class="h1">Öğretmen Paneli</h2>

<div class="card">
	<h3 class="h2">Haftalık Öğretmen Ders Programları</h3>
	{% if teachers_schedules %}
	<!-- Sekme Butonları -->
	<div class="tabs-container" style="margin-bottom:16px;border-bottom:2px solid var(--border);display:flex;flex-wrap:wrap;gap:8px;">
		{% for schedule in teachers_schedules %}
		<button 
			class="tab-button" 
			data-teacher-id="{{ schedule.teacher.id }}"
			style="padding:10px 20px;background:#f1f5f9;color:#475569;border:none;border-radius:8px 8px 0 0;cursor:pointer;font-weight:500;font-size:14px;transition:all 0.2s;{% if schedule.teacher.id == selected_teacher_id %}background:#0ea5e9;color:#fff;{% endif %}"
			onclick="showTeacherSchedule({{ schedule.teacher.id }})">
			{{ schedule.teacher.first_name }} {{ schedule.teacher.last_name }}
		</button>
			{% endfor %}
</div>

	<!-- Öğretmen Programları -->
	{% set weekdays = ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'] %}
	{% set hours = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20] %}
	{% for schedule in teachers_schedules %}
	<div class="teacher-schedule" id="teacher-{{ schedule.teacher.id }}" style="display:{% if schedule.teacher.id == selected_teacher_id %}block{% else %}none{% endif %};">
		<h4 style="margin-bottom:12px;color:#0f172a;font-size:16px;font-weight:600;">
			{{ schedule.teacher.first_name }} {{ schedule.teacher.last_name }} - Haftalık Program
		</h4>
		{% if schedule.lessons %}
		<div style="overflow-x:auto;margin-top:12px;">
			<table style="width:100%;border-collapse:collapse;border:1px solid var(--border);background:#fff;">
				<thead>
					<tr>
						<th style="padding:8px;background:#f1f5f9;border:1px solid var(--border);text-align:left;font-size:12px;font-weight:600;min-width:60px;">Saat</th>
						{% for day_name in weekdays %}
						<th style="padding:8px;background:#f1f5f9;border:1px solid var(--border);text-align:center;font-size:12px;font-weight:600;min-width:120px;">{{ day_name }}</th>
						{% endfor %}
					</tr>
				</thead>
				<tbody>
					{% for hour in hours %}
					<tr>
						<td style="padding:8px;background:#f9fafb;border:1px solid var(--border);text-align:center;font-size:12px;font-weight:600;vertical-align:top;">{{ hour }}:00</td>
		{% for day_name in weekdays %}
						<td style="padding:4px;border:1px solid var(--border);vertical-align:top;min-height:60px;">
							{% for entry in schedule.lessons %}
					{% if entry.weekday == day_name %}
									{% set lesson_start_hour = entry.lesson.start_time.hour if entry.lesson.start_time else None %}
									{% if lesson_start_hour == hour %}
									<div style="padding:6px;background:#e0e7ff;border-radius:6px;margin-bottom:4px;font-size:11px;border-left:3px solid #6366f1;">
										<div style="font-weight:600;color:#0f172a;margin-bottom:2px;">{{ entry.lesson.course.name }}</div>
										<div style="color:#64748b;font-size:10px;margin-bottom:2px;">
							{% if entry.lesson.start_time or entry.lesson.end_time %}
								{{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
							{% endif %}
						</div>
										<div style="color:#64748b;font-size:10px;margin-bottom:2px;">{{ entry.current_lesson_date.strftime('%d.%m') if entry.current_lesson_date else entry.lesson.lesson_date.strftime('%d.%m') }}</div>
						{% if entry.students %}
										<div style="margin-top:4px;padding-top:4px;border-top:1px solid rgba(0,0,0,0.1);">
							{% for s in entry.students %}
												<div style="font-size:10px;color:#475569;">{{ s.first_name }} {{ s.last_name }}</div>
							{% endfor %}
						</div>
						{% endif %}
										{% if schedule.teacher.id == current_teacher_id %}
										<a href="/lessons/{{ entry.lesson.id }}/attendance/new" style="display:inline-block;margin-top:4px;padding:2px 6px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:4px;font-size:10px;">Yoklama</a>
										{% endif %}
					</div>
					{% endif %}
								{% endif %}
							{% endfor %}
						</td>
						{% endfor %}
					</tr>
				{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<p style="color:#64748b;text-align:center;padding:20px;">Bu öğretmen için henüz ders kaydı bulunmuyor.</p>
		{% endif %}
	</div>
	{% endfor %}
	
	<style>
		.tab-button:hover {
			background:#e2e8f0 !important;
		}
		.tab-button.active {
			background:#0ea5e9 !important;
			color:#fff !important;
		}
		@media (max-width: 768px) {
			.tabs-container {
				overflow-x: auto;
				-webkit-overflow-scrolling: touch;
			}
			.tab-button {
				white-space: nowrap;
				font-size: 12px;
				padding: 8px 16px;
			}
		}
	</style>
	
	<script>
		function showTeacherSchedule(teacherId) {
			// URL'yi güncelle
			window.location.href = '/ui/teacher?selected_teacher_id=' + teacherId;
		}
	</script>
	{% else %}
	<p style="color:#64748b;text-align:center;padding:20px;">Henüz öğretmen kaydı bulunmuyor.</p>
	{% endif %}
</div>

<div class="card">
	<h3 class="h2">Puantaj Tablosu</h3>
	<p style="color:var(--muted);margin-top:8px;margin-bottom:16px;font-size:14px;">
		Öğrenciler için aldığınız yoklamalar. Haberli gelmedi durumları tabloya işlenmez. Tarih aralığı seçerek sonuçları filtreleyebilirsiniz.
	</p>
	
	<form method="get" action="/ui/teacher" class="form-row" style="margin-bottom:16px;padding:12px;background:#f9fafb;border-radius:12px;">
		<input type="date" name="start_date" value="{{ start_date }}" placeholder="Başlangıç Tarihi" />
		<input type="date" name="end_date" value="{{ end_date }}" placeholder="Bitiş Tarihi" />
		{% if selected_teacher_id %}
		<input type="hidden" name="selected_teacher_id" value="{{ selected_teacher_id }}" />
		{% endif %}
		<div class="btn-group" style="width:100%;margin-top:8px;">
			<button type="submit" style="flex:1;">Filtrele</button>
			<a href="/ui/teacher{% if selected_teacher_id %}?selected_teacher_id={{ selected_teacher_id }}{% endif %}" style="padding:12px 20px;background:#fff;color:#0f172a;border:1px solid var(--border);border-radius:8px;text-decoration:none;font-weight:500;display:inline-flex;align-items:center;justify-content:center;flex:1;">Temizle</a>
		</div>
	</form>
	
	{% if attendance_report %}
		{% for teacher_report in attendance_report %}
		<div style="margin-bottom:32px;border:1px solid var(--border);border-radius:12px;padding:16px;background:#f9fafb;">
			<h4 style="margin:0 0 16px 0;color:#0f172a;font-size:18px;font-weight:600;padding-bottom:12px;border-bottom:2px solid var(--border);">
				{{ teacher_report.teacher.first_name }} {{ teacher_report.teacher.last_name }}
			</h4>
			{% if teacher_report.students %}
			<div class="table-wrap">
				<table>
					<thead>
						<tr>
							<th>Öğrenci</th>
							<th>Geldi</th>
							<th>Haberli Gelmedi</th>
							<th>Telafi</th>
							<th>Habersiz Gelmedi</th>
							<th>Toplam Ders</th>
						</tr>
					</thead>
					<tbody>
						{% for student_data in teacher_report.students %}
						<tr>
							<td><strong>{{ student_data.student.first_name }} {{ student_data.student.last_name }}</strong></td>
							<td style="text-align:center;color:#10b981;font-weight:600;">{{ student_data.present }}</td>
							<td style="text-align:center;color:#f97316;font-weight:600;">{{ student_data.excused_absent }}</td>
							<td style="text-align:center;color:#8b5cf6;font-weight:600;">{{ student_data.telafi }}</td>
							<td style="text-align:center;color:#ef4444;font-weight:600;">{{ student_data.unexcused_absent }}</td>
							<td style="text-align:center;font-weight:600;">{{ student_data.total }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				<div class="mobile-card-view">
					{% for student_data in teacher_report.students %}
					<div class="mobile-card">
						<div class="mobile-card-row">
							<div class="mobile-card-label">Öğrenci</div>
							<div class="mobile-card-value"><strong>{{ student_data.student.first_name }} {{ student_data.student.last_name }}</strong></div>
						</div>
						<div class="mobile-card-row">
							<div class="mobile-card-label">Geldi</div>
							<div class="mobile-card-value" style="color:#10b981;font-weight:600;">{{ student_data.present }}</div>
						</div>
						<div class="mobile-card-row">
							<div class="mobile-card-label">Haberli Gelmedi</div>
							<div class="mobile-card-value" style="color:#f97316;font-weight:600;">{{ student_data.excused_absent }}</div>
						</div>
						<div class="mobile-card-row">
							<div class="mobile-card-label">Telafi</div>
							<div class="mobile-card-value" style="color:#8b5cf6;font-weight:600;">{{ student_data.telafi }}</div>
						</div>
						<div class="mobile-card-row">
							<div class="mobile-card-label">Habersiz Gelmedi</div>
							<div class="mobile-card-value" style="color:#ef4444;font-weight:600;">{{ student_data.unexcused_absent }}</div>
						</div>
						<div class="mobile-card-row">
							<div class="mobile-card-label">Toplam Ders</div>
							<div class="mobile-card-value" style="font-weight:600;">{{ student_data.total }}</div>
						</div>
					</div>
					{% endfor %}
				</div>
			</div>
			{% else %}
			<p style="color:var(--muted);text-align:center;padding:16px;">Bu öğretmen için henüz yoklama kaydı bulunmuyor.</p>
			{% endif %}
		</div>
		{% endfor %}
	{% else %}
	<p style="color:var(--muted);text-align:center;padding:16px;">
		{% if start_date or end_date %}
			Seçilen tarih aralığı için puantaj verisi bulunmuyor.
		{% else %}
			Puantaj verilerini görmek için lütfen tarih aralığı seçin.
		{% endif %}
	</p>
	{% endif %}
</div>

{% endblock %}



