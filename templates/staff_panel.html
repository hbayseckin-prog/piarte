{% extends "base.html" %}
{% block title %}Personel Paneli - Piarte{% endblock %}
{% block content %}
<div class="h1">ğŸ”‘ Personel Paneli</div>

<!-- BaÅŸarÄ±/Hata MesajlarÄ± -->
{% if success %}
<div style="padding:12px;background:#d1fae5;color:#065f46;border:1px solid #10b981;border-radius:8px;margin-bottom:16px;">
	âœ… {{ success }}
</div>
{% endif %}
{% if error %}
<div style="padding:12px;background:#fee2e2;color:#991b1b;border:1px solid #ef4444;border-radius:8px;margin-bottom:16px;">
	âŒ {{ error }}
</div>
{% endif %}

<!-- Ã–ÄŸrenci Ders ProgramÄ± Arama - En Ãœstte -->
<div class="card">
	<h3 class="h2">Ã–ÄŸrenci Ders ProgramÄ± Arama</h3>
	<form method="get" action="/ui/staff" style="margin-bottom:16px;">
		<div style="display:flex;gap:8px;flex-wrap:wrap;position:relative;">
			<div style="flex:1;min-width:200px;position:relative;">
				<input 
					id="student-search-input"
					type="text" 
					name="search" 
					value="{{ search }}" 
					placeholder="Ã–ÄŸrenci adÄ± veya soyadÄ± ile ara (en az 3 harf)..." 
					autocomplete="off"
					style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;" 
				/>
				<div id="student-autocomplete-results" style="display:none;position:absolute;top:100%;left:0;right:0;z-index:1000;background:#fff;border:1px solid var(--border);border-radius:8px;margin-top:4px;max-height:300px;overflow-y:auto;box-shadow:0 4px 6px rgba(0,0,0,0.1);">
					<!-- Autocomplete sonuÃ§larÄ± buraya eklenecek -->
				</div>
			</div>
			<button type="submit" style="padding:10px 20px;background:#0ea5e9;color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;">Ara</button>
			{% if search %}
			<a href="/ui/staff" style="padding:10px 20px;background:#64748b;color:#fff;text-decoration:none;border-radius:8px;font-weight:500;display:inline-flex;align-items:center;">Temizle</a>
			{% endif %}
		</div>
	</form>
	
	{% if search_results %}
	<div style="margin-bottom:16px;">
		<h4 style="margin-bottom:8px;color:#0f172a;font-size:14px;font-weight:600;">Arama SonuÃ§larÄ±:</h4>
		<div style="display:flex;flex-direction:column;gap:8px;">
			{% for item in search_results %}
			<a 
				href="/ui/staff?student_id={{ item.student.id }}" 
				style="display:block;padding:12px;background:{% if item.needs_payment %}#fee2e2{% else %}#f9fafb{% endif %};border:1px solid {% if item.needs_payment %}#ef4444{% else %}var(--border){% endif %};border-radius:8px;text-decoration:none;color:#0f172a;transition:all 0.2s;border-left:4px solid {% if item.needs_payment %}#ef4444{% else %}transparent{% endif %};"
				onmouseover="this.style.background='{% if item.needs_payment %}#fecaca{% else %}#f1f5f9{% endif %}';this.style.borderColor='#0ea5e9';"
				onmouseout="this.style.background='{% if item.needs_payment %}#fee2e2{% else %}#f9fafb{% endif %}';this.style.borderColor='{% if item.needs_payment %}#ef4444{% else %}var(--border){% endif %}';"
			>
				<strong style="{% if item.needs_payment %}color:#dc2626;{% endif %}">
					{{ item.student.first_name }} {{ item.student.last_name }}
					{% if item.needs_payment %}
					<span style="font-size:12px;color:#dc2626;margin-left:8px;">âš ï¸ Ã–deme Gerekli</span>
					{% endif %}
				</strong>
				{% if item.student.phone %}
				<span style="color:#64748b;font-size:13px;margin-left:8px;display:block;margin-top:4px;">{{ item.student.phone }}</span>
				{% endif %}
			</a>
			{% endfor %}
		</div>
	</div>
	{% elif search and not search_results %}
	<p style="color:#64748b;text-align:center;padding:20px;">Arama sonucu bulunamadÄ±.</p>
	{% endif %}
	
	{% if selected_student %}
	<div style="margin-top:20px;padding:16px;background:#f0f9ff;border:1px solid #0ea5e9;border-radius:12px;">
		<h4 style="margin:0 0 12px 0;color:#0f172a;font-size:16px;font-weight:600;">
			{{ selected_student.first_name }} {{ selected_student.last_name }} - Ders ProgramÄ±
		</h4>
		
		<!-- Toplam Ders SayÄ±sÄ± ve Ders Tarihleri -->
		<div style="margin-bottom:16px;padding:12px;background:#fff;border:1px solid var(--border);border-radius:8px;">
			<div style="display:flex;flex-wrap:wrap;gap:16px;align-items:center;">
				<div style="flex:1;min-width:200px;">
					<strong style="color:#0f172a;font-size:14px;">Toplam Ders SayÄ±sÄ±:</strong>
					<span style="color:#0ea5e9;font-size:16px;font-weight:600;margin-left:8px;">{{ total_lessons_count }}</span>
				</div>
				{% if attendance_dates_sorted %}
				<div style="flex:2;min-width:300px;">
					<strong style="color:#0f172a;font-size:14px;display:block;margin-bottom:4px;">Ders Tarihleri:</strong>
					<div style="display:flex;flex-wrap:wrap;gap:6px;">
						{% for lesson_date in attendance_dates_sorted %}
							<span style="padding:4px 8px;background:#e0e7ff;color:#4338ca;border-radius:6px;font-size:12px;">
								{{ lesson_date.strftime('%d.%m.%Y') if lesson_date else '' }}
							</span>
						{% endfor %}
					</div>
				</div>
				{% endif %}
			</div>
		</div>
		
		{% if student_lessons %}
		{% set weekdays = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'] %}
		<div class="weekly-schedule" style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px">
			{% for day_name in weekdays %}
			<div style="border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff">
				<h4 style="margin:0 0 8px 0;font-size:14px;color:#2563eb;font-weight:600">{{ day_name }}</h4>
				<div style="display:flex;flex-direction:column;gap:8px">
					{% for entry in student_lessons %}
						{% if entry.weekday == day_name %}
						<div style="padding:8px;background:#f9fafb;border-radius:8px;border:1px solid var(--border);font-size:12px">
							<div style="font-weight:600;color:#0f172a;margin-bottom:4px">{{ entry.lesson.course.name }}</div>
							<div style="color:#64748b;font-size:11px;margin-bottom:4px">
								{% if entry.lesson.start_time or entry.lesson.end_time %}
									{{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
								{% endif %}
							</div>
							<div style="color:#64748b;font-size:11px;margin-bottom:4px">{{ entry.current_lesson_date.strftime('%d.%m') if entry.current_lesson_date else entry.lesson.lesson_date.strftime('%d.%m') }}</div>
							<div style="color:#0ea5e9;font-size:11px;font-weight:600;margin-top:4px">
								Ã–ÄŸretmen: {{ entry.lesson.teacher.first_name }} {{ entry.lesson.teacher.last_name }}
							</div>
						</div>
						{% endif %}
					{% endfor %}
				</div>
			</div>
			{% endfor %}
		</div>
		{% else %}
		<p style="color:#64748b;text-align:center;padding:20px;">Bu Ã¶ÄŸrencinin henÃ¼z ders kaydÄ± bulunmuyor.</p>
		{% endif %}
	</div>
	
	<div style="margin-top:20px;padding:16px;background:#f0fdf4;border:1px solid #10b981;border-radius:12px;">
		<h4 style="margin:0 0 12px 0;color:#0f172a;font-size:16px;font-weight:600;">
			Ã–deme GeÃ§miÅŸi
		</h4>
		<div class="table-wrap">
			<table style="width:100%;border-collapse:collapse;">
				<thead>
					<tr style="background:#f9fafb;border-bottom:2px solid var(--border);">
						<th style="padding:10px;text-align:left;font-weight:600;color:#0f172a;font-size:14px;">Tarih</th>
						<th style="padding:10px;text-align:left;font-weight:600;color:#0f172a;font-size:14px;">Tutar</th>
						<th style="padding:10px;text-align:left;font-weight:600;color:#0f172a;font-size:14px;">YÃ¶ntem</th>
						<th style="padding:10px;text-align:left;font-weight:600;color:#0f172a;font-size:14px;">Not</th>
					</tr>
				</thead>
				<tbody>
					{% if selected_student_payments %}
						{% for payment in selected_student_payments %}
						<tr style="border-bottom:1px solid var(--border);">
							<td style="padding:10px;color:#475569;font-size:14px;">{{ payment.payment_date.strftime('%d.%m.%Y') if payment.payment_date else '-' }}</td>
							<td style="padding:10px;color:#0f172a;font-weight:600;font-size:14px;">{{ '%.2f'|format(payment.amount_try) }} â‚º</td>
							<td style="padding:10px;color:#64748b;font-size:14px;">{{ payment.method or '-' }}</td>
							<td style="padding:10px;color:#64748b;font-size:14px;">{{ payment.note or '-' }}</td>
						</tr>
						{% endfor %}
					{% else %}
						<tr>
							<td colspan="4" style="padding:20px;text-align:center;color:#64748b;">Ã–deme kaydÄ± bulunmuyor.</td>
						</tr>
					{% endif %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}
</div>

<div class="card">
  <div style="margin-bottom:16px;">HoÅŸ geldiniz. Buradan temel iÅŸlemleri kolayca eriÅŸebilirsiniz:</div>
  <div class="btn-group">
    <a href="/students/new" style="text-decoration:none;"><button style="width:100%;">Yeni Ã–ÄŸrenci KaydÄ±</button></a>
    <a href="/lessons/new" style="text-decoration:none;"><button style="width:100%;">Ders SeÃ§imi / KayÄ±t</button></a>
    <a href="/payments/new" style="text-decoration:none;"><button style="width:100%;">Ã–deme Al</button></a>
  </div>
</div>

<!-- GeÃ§miÅŸe DÃ¶nÃ¼k KayÄ±t BÃ¶lÃ¼mÃ¼ -->
<div class="card">
	<h3 class="h2">ğŸ“… GeÃ§miÅŸe DÃ¶nÃ¼k KayÄ±t</h3>
	<p style="color:#64748b;margin-bottom:16px;font-size:14px;">
		Ã–ÄŸretmen seÃ§erek geÃ§miÅŸ bir tarih iÃ§in yoklama ve Ã¶deme kaydÄ± oluÅŸturabilirsiniz.
	</p>
	
	<!-- Ã–ÄŸretmen ve Tarih SeÃ§imi -->
	<form method="get" action="/ui/staff" style="margin-bottom:16px;">
		<div style="display:flex;gap:8px;flex-wrap:wrap;align-items:flex-end;">
			<div style="flex:1;min-width:200px;">
				<label for="teacher_id" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Ã–ÄŸretmen</label>
				<select 
					name="teacher_id" 
					id="teacher_id" 
					required
					style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;">
					<option value="">Ã–ÄŸretmen SeÃ§in</option>
					{% for teacher in teachers %}
					<option value="{{ teacher.id }}" {% if selected_teacher_id == teacher.id %}selected{% endif %}>
						{{ teacher.first_name }} {{ teacher.last_name }}
					</option>
					{% endfor %}
				</select>
			</div>
			<div style="flex:1;min-width:200px;">
				<label for="selected_date" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Tarih</label>
				<input 
					type="date" 
					name="selected_date" 
					id="selected_date" 
					value="{{ selected_date or '' }}"
					required
					style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;" 
				/>
			</div>
			<button type="submit" style="padding:10px 20px;background:#0ea5e9;color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;">Ã–ÄŸrencileri Getir</button>
		</div>
	</form>
	
	<!-- Ã–ÄŸrenci Listesi ve Yoklama Formu -->
	{% if selected_teacher and selected_date %}
	<div style="margin-top:20px;padding:16px;background:#f0f9ff;border:1px solid #0ea5e9;border-radius:12px;">
		<h4 style="margin:0 0 12px 0;color:#0f172a;font-size:16px;font-weight:600;">
			{{ selected_teacher.first_name }} {{ selected_teacher.last_name }} - {{ selected_date }} Yoklama GiriÅŸi
		</h4>
		
		{% if selected_teacher_lessons %}
		<form method="post" action="/ui/staff/attendance/retrospective">
			<input type="hidden" name="teacher_id" value="{{ selected_teacher_id }}" />
			<input type="hidden" name="selected_date" value="{{ selected_date }}" />
			
			<div style="display:flex;flex-direction:column;gap:16px;">
				{% for entry in selected_teacher_lessons %}
				<div style="padding:12px;background:#fff;border:1px solid var(--border);border-radius:8px;">
					<h5 style="margin:0 0 8px 0;color:#0f172a;font-size:14px;font-weight:600;">
						{{ entry.lesson.course.name }}
					</h5>
					
					{% if entry.students %}
					<div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
						{% for student in entry.students %}
						<div style="display:flex;align-items:center;gap:12px;padding:8px;background:#f9fafb;border-radius:6px;flex-wrap:wrap;">
							<div style="flex:1;min-width:150px;font-size:14px;color:#0f172a;font-weight:500;">
								{{ student.first_name }} {{ student.last_name }}
							</div>
							<input 
								type="time" 
								name="time_{{ entry.lesson.id }}_{{ student.id }}" 
								style="padding:6px 10px;border:1px solid var(--border);border-radius:6px;font-size:13px;min-width:100px;"
								placeholder="Saat"
							/>
							<select 
								name="status_{{ entry.lesson.id }}_{{ student.id }}" 
								style="padding:6px 10px;border:1px solid var(--border);border-radius:6px;font-size:13px;min-width:150px;">
								<option value="">Durum SeÃ§in</option>
								<option value="PRESENT">âœ… Geldi</option>
								<option value="EXCUSED_ABSENT">ğŸ“ Haberli Gelmedi</option>
								<option value="TELAFI">ğŸ”„ Telafi</option>
								<option value="UNEXCUSED_ABSENT">âŒ Habersiz Gelmedi</option>
							</select>
						</div>
						{% endfor %}
					</div>
					{% else %}
					<p style="color:#64748b;font-size:13px;margin:8px 0 0 0;">Bu derse kayÄ±tlÄ± Ã¶ÄŸrenci yok.</p>
					{% endif %}
				</div>
				{% endfor %}
			</div>
			
			<div style="margin-top:16px;display:flex;gap:8px;">
				<button type="submit" style="padding:10px 20px;background:#10b981;color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;">ğŸ’¾ Yoklama Kaydet</button>
				<a href="/ui/staff" style="padding:10px 20px;background:#64748b;color:#fff;text-decoration:none;border-radius:8px;font-weight:500;display:inline-flex;align-items:center;">Ä°ptal</a>
			</div>
		</form>
		{% else %}
		<p style="color:#64748b;text-align:center;padding:20px;">Bu Ã¶ÄŸretmenin seÃ§ilen gÃ¼nde dersi bulunmuyor.</p>
		{% endif %}
	</div>
	
	<!-- GeÃ§miÅŸe DÃ¶nÃ¼k Ã–deme Formu -->
	<div style="margin-top:20px;padding:16px;background:#fef3c7;border:1px solid #f59e0b;border-radius:12px;">
		<h4 style="margin:0 0 12px 0;color:#0f172a;font-size:16px;font-weight:600;">
			ğŸ’° GeÃ§miÅŸe DÃ¶nÃ¼k Ã–deme KaydÄ±
		</h4>
		<form method="post" action="/ui/staff/payment/retrospective">
			<div style="display:flex;flex-direction:column;gap:12px;">
				<div>
					<label for="payment_student_id" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Ã–ÄŸrenci</label>
					<select 
						name="student_id" 
						id="payment_student_id" 
						required
						style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;">
						<option value="">Ã–ÄŸrenci SeÃ§in</option>
						{% if selected_teacher_lessons %}
							{% for entry in selected_teacher_lessons %}
								{% for student in entry.students %}
								<option value="{{ student.id }}">{{ student.first_name }} {{ student.last_name }}</option>
								{% endfor %}
							{% endfor %}
						{% endif %}
					</select>
				</div>
				<div>
					<label for="payment_amount" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Ã–deme TutarÄ± (TL)</label>
					<input 
						type="number" 
						name="amount" 
						id="payment_amount" 
						step="0.01" 
						required
						placeholder="Ã–rn: 1500"
						style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;" 
					/>
				</div>
				<div>
					<label for="payment_date" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Ã–deme Tarihi</label>
					<input 
						type="date" 
						name="payment_date" 
						id="payment_date" 
						value="{{ selected_date or '' }}"
						required
						style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;" 
					/>
				</div>
				<div>
					<label for="payment_note" style="display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#0f172a;">Not (Opsiyonel)</label>
					<textarea 
						name="note" 
						id="payment_note" 
						rows="2"
						placeholder="Ä°steÄŸe baÄŸlÄ± not..."
						style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;resize:vertical;"></textarea>
				</div>
				<div>
					<button type="submit" style="padding:10px 20px;background:#10b981;color:#fff;border:none;border-radius:8px;font-weight:500;cursor:pointer;">ğŸ’° Ã–deme Kaydet</button>
				</div>
			</div>
		</form>
	</div>
	{% endif %}
</div>

<div class="card">
	<h3 class="h2">Ã–deme Durumu Tablosu</h3>
	<p style="color:#64748b;margin-bottom:16px;font-size:14px;">
		ğŸ“… Tarih: {{ today.strftime('%d.%m.%Y') if today else '-' }} | 
		Ã–deme yapÄ±ldÄ± ise: Her 4 derslik dÃ¶ngÃ¼de 1-2. dersler Ã–dendi, 3. ders Ã–deme Bekleniyor, 4. ders Ã–deme Gerekli | 
		Ã–deme yapÄ±lmadÄ± ise: 0 ders Ã–deme Gerekli, 4 ve 4'Ã¼n katlarÄ± Ã–deme Gerekli
	</p>
	<div class="table-wrap">
		<table>
			<thead>
				<tr>
					<th>Ã–ÄŸrenci AdÄ±</th>
					<th>Toplam Ders</th>
					<th>Beklenen Ã–deme</th>
					<th>YapÄ±lan Ã–deme</th>
					<th>Durum</th>
				</tr>
			</thead>
			<tbody>
				{% for item in payment_status_list %}
				<tr style="{% if item.needs_payment %}background-color:#fee2e2;border-left:4px solid #ef4444;{% endif %}">
					<td>
						<strong style="{% if item.needs_payment %}color:#dc2626;{% endif %}">
							{{ item.student.first_name }} {{ item.student.last_name }}
						</strong>
					</td>
					<td style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{{ item.total_lessons }}
					</td>
					<td style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{% if item.total_paid_sets > 0 %}
							{{ item.expected_paid_sets }} set ({{ item.expected_paid_sets * 4 }} ders)
						{% else %}
							-
						{% endif %}
					</td>
					<td style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{% if item.last_payment_date %}
							{{ item.last_payment_date.strftime('%d.%m.%Y') }}
						{% else %}
							-
						{% endif %}
					</td>
					<td>
						{% if item.payment_status_class == 'needs_payment' %}
						<span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:600;">{{ item.payment_status }}</span>
						{% elif item.payment_status_class == 'paid' %}
						<span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:600;">{{ item.payment_status }}</span>
						{% else %}
						<span style="padding:4px 8px;background:#f59e0b;color:#fff;border-radius:6px;font-size:12px;font-weight:600;">{{ item.payment_status }}</span>
						{% endif %}
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		<div class="mobile-card-view">
			{% for item in payment_status_list %}
			<div class="mobile-card" style="{% if item.needs_payment %}background-color:#fee2e2;border-left:4px solid #ef4444;{% endif %}">
				<div class="mobile-card-row">
					<div class="mobile-card-label">Ã–ÄŸrenci AdÄ±</div>
					<div class="mobile-card-value">
						<strong style="{% if item.needs_payment %}color:#dc2626;{% endif %}">
							{{ item.student.first_name }} {{ item.student.last_name }}
						</strong>
					</div>
				</div>
				<div class="mobile-card-row">
					<div class="mobile-card-label">Toplam Ders</div>
					<div class="mobile-card-value" style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{{ item.total_lessons }}
					</div>
				</div>
				<div class="mobile-card-row">
					<div class="mobile-card-label">Beklenen Ã–deme</div>
					<div class="mobile-card-value" style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{% if item.total_paid_sets > 0 %}
							{{ item.expected_paid_sets }} set ({{ item.expected_paid_sets * 4 }} ders)
						{% else %}
							-
						{% endif %}
					</div>
				</div>
				<div class="mobile-card-row">
					<div class="mobile-card-label">YapÄ±lan Ã–deme</div>
					<div class="mobile-card-value" style="{% if item.needs_payment %}color:#dc2626;font-weight:600;{% endif %}">
						{% if item.last_payment_date %}
							{{ item.last_payment_date.strftime('%d.%m.%Y') }}
						{% else %}
							-
						{% endif %}
					</div>
				</div>
				<div class="mobile-card-row">
					<div class="mobile-card-label">Durum</div>
					<div class="mobile-card-value">
						{% if item.needs_payment %}
						<span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:600;display:inline-block;">âš ï¸ Ã–deme Gerekli</span>
						{% elif item.total_lessons >= 4 %}
						<span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:600;display:inline-block;">âœ… Ã–dendi</span>
						{% else %}
						<span style="padding:4px 8px;background:#64748b;color:#fff;border-radius:6px;font-size:12px;font-weight:600;display:inline-block;">â³ Beklemede</span>
						{% endif %}
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
</div>

<div class="card">
	<h3 class="h2">HaftalÄ±k Ã–ÄŸretmen Ders ProgramlarÄ±</h3>
	{% if teachers_schedules %}
	<!-- Sekme ButonlarÄ± -->
	<div class="tabs-container" style="margin-bottom:16px;border-bottom:2px solid var(--border);display:flex;flex-wrap:wrap;gap:8px;">
		{% for schedule in teachers_schedules %}
		<button 
			class="tab-button" 
			data-teacher-id="{{ schedule.teacher.id }}"
			style="padding:10px 20px;background:#f1f5f9;color:#475569;border:none;border-radius:8px 8px 0 0;cursor:pointer;font-weight:500;font-size:14px;transition:all 0.2s;{% if loop.first %}background:#0ea5e9;color:#fff;{% endif %}"
			onclick="showTeacherSchedule({{ schedule.teacher.id }})">
			{{ schedule.teacher.first_name }} {{ schedule.teacher.last_name }}
		</button>
		{% endfor %}
	</div>
	
	<!-- Ã–ÄŸretmen ProgramlarÄ± -->
	{% set weekdays = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'] %}
	{% set hours = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20] %}
	{% for schedule in teachers_schedules %}
	<div class="teacher-schedule" id="teacher-{{ schedule.teacher.id }}" style="display:{% if loop.first %}block{% else %}none{% endif %};">
		<h4 style="margin-bottom:12px;color:#0f172a;font-size:16px;font-weight:600;">
			{{ schedule.teacher.first_name }} {{ schedule.teacher.last_name }} - HaftalÄ±k Program
		</h4>
		{% if schedule.lessons %}
		<div style="overflow-x:auto;margin-top:12px;">
			<table style="width:100%;border-collapse:collapse;border:1px solid var(--border);background:#fff;">
				<thead>
					<tr>
						<th style="padding:8px;background:#f1f5f9;border:1px solid var(--border);text-align:left;font-size:12px;font-weight:600;min-width:60px;">Saat</th>
						{% for day_name in weekdays %}
						<th style="padding:8px;background:#f1f5f9;border:1px solid var(--border);text-align:center;font-size:12px;font-weight:600;min-width:120px;">{{ day_name }}</th>
						{% endfor %}
					</tr>
				</thead>
				<tbody>
					{% for hour in hours %}
					<tr>
						<td style="padding:8px;background:#f9fafb;border:1px solid var(--border);text-align:center;font-size:12px;font-weight:600;vertical-align:top;">{{ hour }}:00</td>
						{% for day_name in weekdays %}
						<td style="padding:4px;border:1px solid var(--border);vertical-align:top;min-height:60px;">
							{% for entry in schedule.lessons %}
								{% if entry.weekday == day_name %}
									{% set lesson_start_hour = entry.lesson.start_time.hour if entry.lesson.start_time else None %}
									{% if lesson_start_hour == hour %}
									<div style="padding:6px;background:#e0e7ff;border-radius:6px;margin-bottom:4px;font-size:11px;border-left:3px solid #6366f1;">
										<div style="font-weight:600;color:#0f172a;margin-bottom:2px;">{{ entry.lesson.course.name }}</div>
										<div style="color:#64748b;font-size:10px;margin-bottom:2px;">
											{% if entry.lesson.start_time or entry.lesson.end_time %}
												{{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
											{% endif %}
										</div>
										<div style="color:#64748b;font-size:10px;margin-bottom:2px;">{{ entry.current_lesson_date.strftime('%d.%m') if entry.current_lesson_date else entry.lesson.lesson_date.strftime('%d.%m') }}</div>
										{% if entry.students %}
										<div style="margin-top:4px;padding-top:4px;border-top:1px solid rgba(0,0,0,0.1);">
											{% for s in entry.students %}
												<div style="font-size:10px;color:#475569;">{{ s.first_name }} {{ s.last_name }}</div>
											{% endfor %}
										</div>
										{% endif %}
									</div>
									{% endif %}
								{% endif %}
							{% endfor %}
						</td>
						{% endfor %}
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<p style="color:#64748b;text-align:center;padding:20px;">Bu Ã¶ÄŸretmen iÃ§in henÃ¼z ders kaydÄ± bulunmuyor.</p>
		{% endif %}
	</div>
	{% endfor %}
	
	<style>
		.tab-button:hover {
			background:#e2e8f0 !important;
		}
		.tab-button.active {
			background:#0ea5e9 !important;
			color:#fff !important;
		}
		@media (max-width: 768px) {
			.weekly-schedule {
				grid-template-columns: repeat(2, 1fr) !important;
			}
			.tabs-container {
				overflow-x: auto;
				-webkit-overflow-scrolling: touch;
			}
			.tab-button {
				white-space: nowrap;
				font-size: 12px;
				padding: 8px 16px;
			}
		}
		@media (max-width: 480px) {
			.weekly-schedule {
				grid-template-columns: 1fr !important;
			}
		}
	</style>
	
	<script>
		function showTeacherSchedule(teacherId) {
			// TÃ¼m Ã¶ÄŸretmen programlarÄ±nÄ± gizle
			document.querySelectorAll('.teacher-schedule').forEach(function(el) {
				el.style.display = 'none';
			});
			
			// TÃ¼m sekme butonlarÄ±nÄ± pasif yap
			document.querySelectorAll('.tab-button').forEach(function(btn) {
				btn.style.background = '#f1f5f9';
				btn.style.color = '#475569';
			});
			
			// SeÃ§ilen Ã¶ÄŸretmen programÄ±nÄ± gÃ¶ster
			const scheduleEl = document.getElementById('teacher-' + teacherId);
			if (scheduleEl) {
				scheduleEl.style.display = 'block';
			}
			
			// SeÃ§ilen sekme butonunu aktif yap
			const activeBtn = document.querySelector('[data-teacher-id="' + teacherId + '"]');
			if (activeBtn) {
				activeBtn.style.background = '#0ea5e9';
				activeBtn.style.color = '#fff';
			}
		}
	</script>
	{% else %}
	<p style="color:#64748b;text-align:center;padding:20px;">HenÃ¼z Ã¶ÄŸretmen kaydÄ± bulunmuyor.</p>
	{% endif %}
</div>

<script>
	// Ã–ÄŸrenci arama autocomplete Ã¶zelliÄŸi
	(function() {
		const searchInput = document.getElementById('student-search-input');
		const resultsContainer = document.getElementById('student-autocomplete-results');
		let searchTimeout = null;
		let selectedIndex = -1;

		if (!searchInput || !resultsContainer) {
			return; // Elementler bulunamadÄ±ysa Ã§Ä±k
		}

		// Input'a yazÄ±ldÄ±ÄŸÄ±nda
		searchInput.addEventListener('input', function(e) {
			const query = e.target.value.trim();
			
			// Ã–nceki timeout'u temizle
			if (searchTimeout) {
				clearTimeout(searchTimeout);
			}

			// En az 3 karakter gerekiyor
			if (query.length < 3) {
				resultsContainer.style.display = 'none';
				return;
			}

			// Debounce: 300ms bekle
			searchTimeout = setTimeout(() => {
				fetch(`/api/students/search?q=${encodeURIComponent(query)}`)
					.then(response => response.json())
					.then(data => {
						displayResults(data);
					})
					.catch(error => {
						console.error('Arama hatasÄ±:', error);
						resultsContainer.style.display = 'none';
					});
			}, 300);
		});

		// SonuÃ§larÄ± gÃ¶ster
		function displayResults(students) {
			if (!students || students.length === 0) {
				resultsContainer.style.display = 'none';
				return;
			}

			resultsContainer.innerHTML = '';
			students.forEach((student, index) => {
				const item = document.createElement('div');
				item.style.cssText = 'padding:10px 12px;cursor:pointer;border-bottom:1px solid #f1f5f9;transition:background 0.2s;';
				item.innerHTML = `
					<div style="font-weight:600;color:#0f172a;font-size:14px;">${student.full_name}</div>
					${student.phone ? `<div style="color:#64748b;font-size:12px;margin-top:2px;">${student.phone}</div>` : ''}
				`;
				
				// Hover efekti
				item.addEventListener('mouseenter', function() {
					this.style.background = '#f1f5f9';
				});
				item.addEventListener('mouseleave', function() {
					this.style.background = '#fff';
				});

				// TÄ±klama
				item.addEventListener('click', function() {
					window.location.href = `/ui/staff?student_id=${student.id}`;
				});

				resultsContainer.appendChild(item);
			});

			resultsContainer.style.display = 'block';
			selectedIndex = -1;
		}

		// Klavye navigasyonu
		searchInput.addEventListener('keydown', function(e) {
			const items = resultsContainer.querySelectorAll('div[style*="cursor:pointer"]');
			
			if (e.key === 'ArrowDown') {
				e.preventDefault();
				selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
				updateSelection(items);
			} else if (e.key === 'ArrowUp') {
				e.preventDefault();
				selectedIndex = Math.max(selectedIndex - 1, -1);
				updateSelection(items);
			} else if (e.key === 'Enter' && selectedIndex >= 0 && items[selectedIndex]) {
				e.preventDefault();
				items[selectedIndex].click();
			} else if (e.key === 'Escape') {
				resultsContainer.style.display = 'none';
			}
		});

		function updateSelection(items) {
			items.forEach((item, index) => {
				if (index === selectedIndex) {
					item.style.background = '#e0e7ff';
				} else {
					item.style.background = '#fff';
				}
			});
		}

		// DÄ±ÅŸarÄ± tÄ±klandÄ±ÄŸÄ±nda kapat
		document.addEventListener('click', function(e) {
			if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
				resultsContainer.style.display = 'none';
			}
		});
	})();
</script>

<script>
	// Yoklama dÃ¼zeltme iÃ§in Ã¶ÄŸretmen/Ã¶ÄŸrenci arama autocomplete
	(function() {
		const editSearchInput = document.getElementById('edit_search_input');
		const editResultsContainer = document.getElementById('edit-autocomplete-results');
		let editSearchTimeout = null;

		if (!editSearchInput || !editResultsContainer) {
			return;
		}

		editSearchInput.addEventListener('input', function(e) {
			const query = e.target.value.trim();
			
			if (editSearchTimeout) {
				clearTimeout(editSearchTimeout);
			}

			if (query.length < 3) {
				editResultsContainer.style.display = 'none';
				return;
			}

			editSearchTimeout = setTimeout(() => {
				// Hem Ã¶ÄŸrenci hem Ã¶ÄŸretmen aramasÄ± yap
				Promise.all([
					fetch(`/api/students/search?q=${encodeURIComponent(query)}`).then(r => r.json()),
					fetch(`/api/teachers/search?q=${encodeURIComponent(query)}`).then(r => r.json())
				]).then(([students, teachers]) => {
					displayEditResults(students, teachers);
				}).catch(error => {
					console.error('Arama hatasÄ±:', error);
					editResultsContainer.style.display = 'none';
				});
			}, 300);
		});

		function displayEditResults(students, teachers) {
			if ((!students || students.length === 0) && (!teachers || teachers.length === 0)) {
				editResultsContainer.style.display = 'none';
				return;
			}

			editResultsContainer.innerHTML = '';
			
			// Ã–ÄŸrenciler
			if (students && students.length > 0) {
				const section = document.createElement('div');
				section.style.cssText = 'padding:8px 12px;background:#f9fafb;border-bottom:1px solid var(--border);font-size:12px;font-weight:600;color:#64748b;';
				section.textContent = 'Ã–ÄŸrenciler';
				editResultsContainer.appendChild(section);
				
				students.forEach(student => {
					const item = document.createElement('div');
					item.style.cssText = 'padding:10px 12px;cursor:pointer;border-bottom:1px solid #f1f5f9;transition:background 0.2s;';
					item.innerHTML = `
						<div style="font-weight:600;color:#0f172a;font-size:14px;">${student.full_name}</div>
						${student.phone ? `<div style="color:#64748b;font-size:12px;margin-top:2px;">${student.phone}</div>` : ''}
					`;
					
					item.addEventListener('mouseenter', function() {
						this.style.background = '#f1f5f9';
					});
					item.addEventListener('mouseleave', function() {
						this.style.background = '#fff';
					});

					item.addEventListener('click', function() {
						window.location.href = `/ui/staff?edit_search=${encodeURIComponent(student.full_name)}`;
					});

					editResultsContainer.appendChild(item);
				});
			}
			
			// Ã–ÄŸretmenler
			if (teachers && teachers.length > 0) {
				const section = document.createElement('div');
				section.style.cssText = 'padding:8px 12px;background:#f9fafb;border-bottom:1px solid var(--border);font-size:12px;font-weight:600;color:#64748b;';
				section.textContent = 'Ã–ÄŸretmenler';
				editResultsContainer.appendChild(section);
				
				teachers.forEach(teacher => {
					const item = document.createElement('div');
					item.style.cssText = 'padding:10px 12px;cursor:pointer;border-bottom:1px solid #f1f5f9;transition:background 0.2s;';
					item.innerHTML = `
						<div style="font-weight:600;color:#0f172a;font-size:14px;">${teacher.full_name}</div>
					`;
					
					item.addEventListener('mouseenter', function() {
						this.style.background = '#f1f5f9';
					});
					item.addEventListener('mouseleave', function() {
						this.style.background = '#fff';
					});

					item.addEventListener('click', function() {
						window.location.href = `/ui/staff?edit_search=${encodeURIComponent(teacher.full_name)}`;
					});

					editResultsContainer.appendChild(item);
				});
			}

			editResultsContainer.style.display = 'block';
		}

		// DÄ±ÅŸarÄ± tÄ±klandÄ±ÄŸÄ±nda kapat
		document.addEventListener('click', function(e) {
			if (!editSearchInput.contains(e.target) && !editResultsContainer.contains(e.target)) {
				editResultsContainer.style.display = 'none';
			}
		});
	})();
</script>

<script>
	// Sayfa yÃ¼klendiÄŸinde eÄŸer arama yapÄ±lmÄ±ÅŸsa, arama bÃ¶lÃ¼mÃ¼ne scroll yap
	(function() {
		// URL'de edit_search parametresi var mÄ± kontrol et
		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.has('edit_search')) {
			// Sayfa yÃ¼klendikten sonra arama bÃ¶lÃ¼mÃ¼ne scroll yap
			setTimeout(function() {
				const yoklamaBolumu = document.getElementById('yoklama-duzeltme-bolumu');
				if (yoklamaBolumu) {
					yoklamaBolumu.scrollIntoView({ behavior: 'smooth', block: 'start' });
					// Alternatif: window.scrollTo ile
					// window.scrollTo({ top: yoklamaBolumu.offsetTop - 20, behavior: 'smooth' });
				}
			}, 100);
		}
	})();
</script>

<div class="card" style="padding:0;overflow:hidden;" id="yoklama-duzeltme-bolumu">
    <!-- NavigatÃ¶r Stili Arama Ã‡ubuÄŸu -->
    <div style="background:linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);padding:20px;border-bottom:3px solid #0369a1;">
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <div style="display:flex;align-items:center;gap:8px;flex-shrink:0;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:#fff;">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <h3 style="margin:0;color:#fff;font-size:18px;font-weight:600;">Yoklama DÃ¼zeltme</h3>
            </div>
            <div style="flex:1;min-width:300px;position:relative;max-width:700px;margin-left:auto;">
                <form method="get" action="/ui/staff" id="edit_search_form" style="display:flex;gap:0;align-items:stretch;background:#ffffff;border:2px solid #ffffff;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.2);overflow:hidden;min-height:50px;">
                    <div style="flex:1;position:relative;min-width:200px;">
                        <input 
                            id="edit_search_input"
                            type="text" 
                            name="edit_search" 
                            value="{{ edit_search if edit_search else '' }}" 
                            placeholder="Ã–ÄŸretmen veya Ã¶ÄŸrenci adÄ± yazÄ±n..." 
                            autocomplete="off"
                            required
                            style="width:100%;height:100%;min-height:50px;padding:14px 20px;border:none;border-radius:10px 0 0 10px;font-size:16px;background:#ffffff;outline:none;color:#0f172a;font-weight:400;box-sizing:border-box;" 
                        />
                        <div id="edit-autocomplete-results" style="display:none;position:absolute;top:100%;left:0;right:0;z-index:1000;background:#fff;border:2px solid #e2e8f0;border-radius:8px;margin-top:4px;max-height:300px;overflow-y:auto;box-shadow:0 4px 12px rgba(0,0,0,0.15);"></div>
                    </div>
                    <button type="submit" style="padding:14px 32px;background:#10b981;color:#fff;border:none;border-radius:0;font-weight:600;cursor:pointer;white-space:nowrap;font-size:16px;transition:background 0.2s;display:flex;align-items:center;gap:8px;min-height:50px;box-sizing:border-box;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        Ara
                    </button>
                    {% if edit_search %}
                    <a href="/ui/staff" style="padding:14px 20px;background:#64748b;color:#fff;text-decoration:none;border-radius:0;font-weight:500;display:inline-flex;align-items:center;white-space:nowrap;font-size:16px;transition:background 0.2s;border-left:2px solid rgba(255,255,255,0.3);min-height:50px;box-sizing:border-box;" onmouseover="this.style.background='#475569'" onmouseout="this.style.background='#64748b'">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px;">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Temizle
                    </a>
                    {% endif %}
                </form>
            </div>
        </div>
        <p style="margin:12px 0 0 0;color:rgba(255,255,255,0.9);font-size:13px;font-weight:400;">
            Ã–ÄŸretmen veya Ã¶ÄŸrenci ismi ile yoklama kayÄ±tlarÄ±nÄ± arayÄ±p dÃ¼zenleyebilirsiniz.
        </p>
    </div>
    
    <div style="padding:16px;">
    
        {% if edit_attendances %}
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Yoklama Tarihi</th>
                        <th>Saat</th>
                        <th>Kurs</th>
                        <th>Ã–ÄŸretmen</th>
                        <th>Ã–ÄŸrenci</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody>
                {% for entry in edit_attendances %}
                <tr>
                    <td>{{ entry.attendance.marked_at.strftime('%d.%m.%Y') if entry.attendance and entry.attendance.marked_at else '-' }}</td>
                    <td>
                        {% if entry.lesson and (entry.lesson.start_time or entry.lesson.end_time) %}
                            {{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
                        {% else %}-{% endif %}
                    </td>
                    <td><strong>{{ entry.course.name if entry.course else '-' }}</strong></td>
                    <td>{% if entry.teacher %}{{ entry.teacher.first_name }} {{ entry.teacher.last_name }}{% else %}-{% endif %}</td>
                    <td><strong>{{ entry.student.first_name }} {{ entry.student.last_name }}</strong></td>
                    <td>
                        {% if entry.attendance.status == 'PRESENT' %}
                            <span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Geldi</span>
                        {% elif entry.attendance.status == 'UNEXCUSED_ABSENT' %}
                            <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                        {% elif entry.attendance.status == 'EXCUSED_ABSENT' %}
                            <span style="padding:4px 8px;background:#f97316;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Haberli gelmedi</span>
                        {% elif entry.attendance.status == 'TELAFI' or entry.attendance.status == 'LATE' %}
                            <span style="padding:4px 8px;background:#8b5cf6;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Telafi</span>
                        {% else %}
                            {{ entry.attendance.status }}
                        {% endif %}
                    </td>
                    <td>
                        <a href="/attendances/{{ entry.attendance.id }}/edit" style="padding:6px 12px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:6px;font-size:12px;font-weight:500;white-space:nowrap;">âœï¸ DÃ¼zenle</a>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <div class="mobile-card-view">
                {% for entry in edit_attendances %}
                <div class="mobile-card">
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Yoklama Tarihi</div>
                        <div class="mobile-card-value">{{ entry.attendance.marked_at.strftime('%d.%m.%Y') if entry.attendance and entry.attendance.marked_at else '-' }}</div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Saat</div>
                        <div class="mobile-card-value">
                            {% if entry.lesson and (entry.lesson.start_time or entry.lesson.end_time) %}
                                {{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
                            {% else %}-{% endif %}
                        </div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Kurs</div>
                        <div class="mobile-card-value"><strong>{{ entry.course.name if entry.course else '-' }}</strong></div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Ã–ÄŸretmen</div>
                        <div class="mobile-card-value">{% if entry.teacher %}{{ entry.teacher.first_name }} {{ entry.teacher.last_name }}{% else %}-{% endif %}</div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Ã–ÄŸrenci</div>
                        <div class="mobile-card-value"><strong>{{ entry.student.first_name }} {{ entry.student.last_name }}</strong></div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Durum</div>
                        <div class="mobile-card-value">
                            {% if entry.attendance.status == 'PRESENT' %}
                                <span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Geldi</span>
                            {% elif entry.attendance.status == 'UNEXCUSED_ABSENT' %}
                                <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                            {% elif entry.attendance.status == 'EXCUSED_ABSENT' %}
                                <span style="padding:4px 8px;background:#f97316;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Haberli gelmedi</span>
                            {% elif entry.attendance.status == 'TELAFI' or entry.attendance.status == 'LATE' %}
                                <span style="padding:4px 8px;background:#8b5cf6;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Telafi</span>
                            {% else %}
                                {{ entry.attendance.status }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="mobile-card-row">
                        <div class="mobile-card-label">Ä°ÅŸlem</div>
                        <div class="mobile-card-value">
                            <a href="/attendances/{{ entry.attendance.id }}/edit" style="padding:8px 16px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:8px;font-size:13px;font-weight:500;display:block;text-align:center;">âœï¸ DÃ¼zenle</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% elif edit_search %}
        <p style="color:#64748b;text-align:center;padding:20px;">Arama sonucu bulunamadÄ±.</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <h3 class="h2">Yoklamalar</h3>
    <form method="get" action="/ui/staff" class="form-row" style="margin-bottom:16px;padding:12px;background:#f9fafb;border-radius:12px;">
        <input type="date" name="start_date" value="{{ filters.start_date if filters else '' }}" placeholder="BaÅŸlangÄ±Ã§ Tarihi" />
        <input type="date" name="end_date" value="{{ filters.end_date if filters else '' }}" placeholder="BitiÅŸ Tarihi" />
        <select name="attendance_teacher_id">
            <option value="">TÃ¼m Ã–ÄŸretmenler</option>
            {% for t in teachers %}
            <option value="{{ t.id }}" {% if filters and filters.teacher_id == t.id %}selected{% endif %}>{{ t.first_name }} {{ t.last_name }}</option>
            {% endfor %}
        </select>
        <select name="attendance_student_id">
            <option value="">TÃ¼m Ã–ÄŸrenciler</option>
            {% for s in students %}
            <option value="{{ s.id }}" {% if filters and filters.student_id == s.id %}selected{% endif %}>{{ s.first_name }} {{ s.last_name }}</option>
            {% endfor %}
        </select>
        <select name="attendance_course_id">
            <option value="">TÃ¼m Kurslar</option>
            {% for c in courses %}
            <option value="{{ c.id }}" {% if filters and filters.course_id == c.id %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
        </select>
        <select name="status">
            <option value="">TÃ¼m Durumlar</option>
            <option value="PRESENT" {% if filters and filters.status == 'PRESENT' %}selected{% endif %}>Geldi</option>
            <option value="EXCUSED_ABSENT" {% if filters and filters.status == 'EXCUSED_ABSENT' %}selected{% endif %}>Haberli Gelmedi</option>
            <option value="TELAFI" {% if filters and (filters.status == 'TELAFI' or filters.status == 'LATE') %}selected{% endif %}>Telafi</option>
            <option value="UNEXCUSED_ABSENT" {% if filters and filters.status == 'UNEXCUSED_ABSENT' %}selected{% endif %}>Habersiz Gelmedi</option>
        </select>
        <select name="order_by">
            <option value="marked_at_desc" {% if filters and filters.order_by == 'marked_at_desc' %}selected{% endif %}>Yoklama ZamanÄ± (Yeni â†’ Eski)</option>
            <option value="marked_at_asc" {% if filters and filters.order_by == 'marked_at_asc' %}selected{% endif %}>Yoklama ZamanÄ± (Eski â†’ Yeni)</option>
            <option value="lesson_date_desc" {% if filters and filters.order_by == 'lesson_date_desc' %}selected{% endif %}>Yoklama Tarihi (Yeni â†’ Eski)</option>
            <option value="lesson_date_asc" {% if filters and filters.order_by == 'lesson_date_asc' %}selected{% endif %}>Yoklama Tarihi (Eski â†’ Yeni)</option>
        </select>
        <div class="btn-group" style="width:100%;margin-top:8px;">
            <button type="submit" style="flex:1;">Filtrele</button>
            <a href="/ui/staff" style="padding:12px 20px;background:#fff;color:#0f172a;border:1px solid var(--border);border-radius:8px;text-decoration:none;font-weight:500;display:inline-flex;align-items:center;justify-content:center;flex:1;">Temizle</a>
        </div>
    </form>
    {% if attendances %}
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Yoklama Tarihi</th>
                    <th>Saat</th>
                    <th>Kurs</th>
                    <th>Ã–ÄŸretmen</th>
                    <th>Ã–ÄŸrenci</th>
                    <th>Durum</th>
                    <th>Yoklama ZamanÄ±</th>
                </tr>
            </thead>
            <tbody>
            {% for entry in attendances %}
            <tr>
                <td>{{ entry.attendance.marked_at.strftime('%d.%m.%Y') if entry.attendance and entry.attendance.marked_at else '-' }}</td>
                <td>
                    {% if entry.lesson and (entry.lesson.start_time or entry.lesson.end_time) %}
                        {{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
                    {% else %}-{% endif %}
                </td>
                <td><strong>{{ entry.course.name if entry.course else '-' }}</strong></td>
                <td>{% if entry.teacher %}{{ entry.teacher.first_name }} {{ entry.teacher.last_name }}{% else %}-{% endif %}</td>
                <td><strong>{{ entry.student.first_name }} {{ entry.student.last_name }} {% if not entry.student %}(Ã–ÄŸrenci ID: {{ entry.attendance.student_id }}){% endif %}</strong></td>
                <td>
                    {% if entry.attendance.status == 'PRESENT' %}
                        <span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Geldi</span>
                    {% elif entry.attendance.status == 'UNEXCUSED_ABSENT' %}
                        <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                    {% elif entry.attendance.status == 'EXCUSED_ABSENT' %}
                        <span style="padding:4px 8px;background:#f97316;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Haberli gelmedi</span>
                    {% elif entry.attendance.status == 'TELAFI' or entry.attendance.status == 'LATE' %}
                        <span style="padding:4px 8px;background:#8b5cf6;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Telafi</span>
                    {% elif entry.attendance.status == 'ABSENT' %}
                        <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                    {% else %}
                        {{ entry.attendance.status }}
                    {% endif %}
                </td>
                <td>{{ entry.attendance.marked_at.strftime('%d.%m.%Y %H:%M') if entry.attendance.marked_at else '-' }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="mobile-card-view">
            {% for entry in attendances %}
            <div class="mobile-card">
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Yoklama Tarihi</div>
                    <div class="mobile-card-value">{{ entry.attendance.marked_at.strftime('%d.%m.%Y') if entry.attendance and entry.attendance.marked_at else '-' }}</div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Saat</div>
                    <div class="mobile-card-value">
                        {% if entry.lesson and (entry.lesson.start_time or entry.lesson.end_time) %}
                            {{ entry.lesson.start_time.strftime('%H:%M') if entry.lesson.start_time else '' }} - {{ entry.lesson.end_time.strftime('%H:%M') if entry.lesson.end_time else '' }}
                        {% else %}-{% endif %}
                    </div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Kurs</div>
                    <div class="mobile-card-value"><strong>{{ entry.course.name if entry.course else '-' }}</strong></div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Ã–ÄŸretmen</div>
                    <div class="mobile-card-value">{% if entry.teacher %}{{ entry.teacher.first_name }} {{ entry.teacher.last_name }}{% else %}-{% endif %}</div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Ã–ÄŸrenci</div>
                    <div class="mobile-card-value"><strong>{{ entry.student.first_name }} {{ entry.student.last_name }} {% if not entry.student %}(Ã–ÄŸrenci ID: {{ entry.attendance.student_id }}){% endif %}</strong></div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Durum</div>
                    <div class="mobile-card-value">
                        {% if entry.attendance.status == 'PRESENT' %}
                            <span style="padding:4px 8px;background:#10b981;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Geldi</span>
                        {% elif entry.attendance.status == 'UNEXCUSED_ABSENT' %}
                            <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                        {% elif entry.attendance.status == 'EXCUSED_ABSENT' %}
                            <span style="padding:4px 8px;background:#f97316;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Haberli gelmedi</span>
                        {% elif entry.attendance.status == 'TELAFI' or entry.attendance.status == 'LATE' %}
                            <span style="padding:4px 8px;background:#8b5cf6;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Telafi</span>
                        {% elif entry.attendance.status == 'ABSENT' %}
                            <span style="padding:4px 8px;background:#ef4444;color:#fff;border-radius:6px;font-size:12px;font-weight:500;">Habersiz gelmedi</span>
                        {% else %}
                            {{ entry.attendance.status }}
                        {% endif %}
                    </div>
                </div>
                <div class="mobile-card-row">
                    <div class="mobile-card-label">Yoklama ZamanÄ±</div>
                    <div class="mobile-card-value">{{ entry.attendance.marked_at.strftime('%d.%m.%Y %H:%M') if entry.attendance.marked_at else '-' }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <p>HenÃ¼z yoklama kaydÄ± bulunmuyor.</p>
    {% endif %}
</div>

{% endblock %}
