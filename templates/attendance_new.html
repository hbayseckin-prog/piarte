{% extends "base.html" %}
{% block title %}Yoklama - Piarte{% endblock %}
{% block content %}
<div class="card">
	<h2 class="h1">Yoklama - Ders #{{ lesson.id }}</h2>
	<p style="color:var(--muted);margin-bottom:16px;">{{ lesson.lesson_date.strftime('%d.%m.%Y') if lesson.lesson_date else '-' }}</p>
	<form method="post" action="/lessons/{{ lesson.id }}/attendance/new">
		<div style="margin-bottom:16px;display:flex;flex-direction:column;gap:6px;">
			<label for="attendance_date" style="font-weight:600;color:#0f172a;">Yoklama Tarihi</label>
			<input
				type="date"
				id="attendance_date"
				name="attendance_date"
				value="{{ attendance_date }}"
				style="padding:10px;border:1px solid var(--border);border-radius:8px;"
			/>
			<small style="color:#64748b;">Öğrenciler farklı günde geldiğinde tarihi değiştirerek yoklama alabilirsiniz.</small>
		</div>
		<div class="table-wrap">
			<table>
				<thead><tr><th>Öğrenci</th><th>Durum</th></tr></thead>
				<tbody>
				{% for item in students_with_status %}
				<tr style="{% if item.needs_payment %}background-color:#fee2e2;border-left:4px solid #ef4444;{% endif %}">
					<td>
						<strong style="{% if item.needs_payment %}color:#dc2626;{% endif %}">
							{{ item.student.first_name }} {{ item.student.last_name }}
							{% if item.needs_payment %}
							<span style="font-size:12px;color:#dc2626;margin-left:8px;">⚠️ Ödeme Gerekli</span>
							{% endif %}
						</strong>
					</td>
					<td>
						<select name="status_{{ item.student.id }}" style="width:100%;max-width:100%;">
							<option value="">-</option>
							<option value="PRESENT" {% if item.current_status == "PRESENT" %}selected{% endif %}>Geldi</option>
							<option value="EXCUSED_ABSENT" {% if item.current_status == "EXCUSED_ABSENT" %}selected{% endif %}>Haberli Gelmedi</option>
							<option value="TELAFI" {% if item.current_status == "TELAFI" or item.current_status == "LATE" %}selected{% endif %}>Telafi</option>
							<option value="UNEXCUSED_ABSENT" {% if item.current_status == "UNEXCUSED_ABSENT" %}selected{% endif %}>Habersiz Gelmedi</option>
						</select>
					</td>
				</tr>
				{% endfor %}
				</tbody>
			</table>
			<div class="mobile-card-view">
				{% for item in students_with_status %}
				<div class="mobile-card" style="{% if item.needs_payment %}background-color:#fee2e2;border-left:4px solid #ef4444;{% endif %}">
					<div class="mobile-card-row">
						<div class="mobile-card-label">Öğrenci</div>
						<div class="mobile-card-value">
							<strong style="{% if item.needs_payment %}color:#dc2626;{% endif %}">
								{{ item.student.first_name }} {{ item.student.last_name }}
								{% if item.needs_payment %}
								<span style="font-size:12px;color:#dc2626;margin-left:8px;display:block;margin-top:4px;">⚠️ Ödeme Gerekli</span>
								{% endif %}
							</strong>
						</div>
					</div>
					<div class="mobile-card-row">
						<div class="mobile-card-label">Durum</div>
						<div class="mobile-card-value">
							<select name="status_{{ item.student.id }}" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:15px;">
								<option value="">-</option>
								<option value="PRESENT" {% if item.current_status == "PRESENT" %}selected{% endif %}>Geldi</option>
								<option value="UNEXCUSED_ABSENT" {% if item.current_status == "UNEXCUSED_ABSENT" %}selected{% endif %}>Habersiz gelmedi</option>
								<option value="EXCUSED_ABSENT" {% if item.current_status == "EXCUSED_ABSENT" %}selected{% endif %}>Haberli gelmedi</option>
								<option value="LATE" {% if item.current_status == "LATE" %}selected{% endif %}>Haberli gelmedi</option>
							</select>
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
		</div>
		<div style="margin-top:16px;">
			<button type="submit" style="width:100%;max-width:100%;margin:0 auto;display:block;min-height:48px;font-size:16px;">Kaydet</button>
		</div>
	</form>
</div>
{% endblock %}
