{% extends "base.html" %}
{% block title %}Ödeme Raporu - Piarte{% endblock %}
{% block content %}
<h2>Ödeme Raporu</h2>
<form method="get" action="/ui/reports/payments" style="margin-bottom:12px">
	<label>Başlangıç</label>
	<input type="date" name="start" value="{{ start }}" />
	<label>Bitiş</label>
	<input type="date" name="end" value="{{ end }}" />
	<label>Kurs</label>
	<select name="course_id">
		<option value="">Hepsi</option>
		{% for c in courses %}
		<option value="{{ c.id }}" {% if course_id and c.id == course_id %}selected{% endif %}>{{ c.name }}</option>
		{% endfor %}
	</select>
	<label>Öğretmen</label>
	<select name="teacher_id">
		<option value="">Hepsi</option>
		{% for t in teachers %}
		<option value="{{ t.id }}" {% if teacher_id and t.id == teacher_id %}selected{% endif %}>{{ t.first_name }} {{ t.last_name }}</option>
		{% endfor %}
	</select>
	<button type="submit">Filtrele</button>
</form>

<div class="card">
	<strong>Toplam: {{ '%.2f'|format(total) }} TL</strong>
    <div style="margin-top:8px">
        <a href="/ui/reports/payments.csv?start={{ start }}&end={{ end }}&course_id={{ course_id }}&teacher_id={{ teacher_id }}">CSV indir</a>
        <button onclick="window.print()" style="margin-left:8px">Yazdır / PDF</button>
    </div>
</div>

<table>
	<thead><tr><th>Tarih</th><th>Öğrenci</th><th>Tutar</th><th>Yöntem</th><th>Not</th></tr></thead>
	<tbody>
	{% for p in items %}
	<tr>
		<td>{{ p.payment_date }}</td>
		<td>{{ p.student.first_name }} {{ p.student.last_name }}</td>
		<td>{{ '%.2f'|format(p.amount_try) }}</td>
		<td>{{ p.method or '-' }}</td>
		<td>{{ p.note or '' }}</td>
	</tr>
	{% else %}
	<tr><td colspan="5">Kayıt bulunmuyor.</td></tr>
	{% endfor %}
	</tbody>
</table>
{% endblock %}


